<!--××¢×¨×›×ª ×”×“×¤×¡×ª ××“×‘×§×•×ª ×©×˜×— ×¢×‘×•×¨ ×™×‘×•×× ×™ ×›×œ×™ ×¢×‘×•×“×” - ×’×¨×¡×” ×¡×•×¤×™×ª ×œ×”×¢×œ××” ×œ×©×¨×ª HTTPS.×”×§×•×“ ×›×•×œ×œ:1. ×˜×¢×™× ×ª ××—×™×¨×•×Ÿ ××§×•×‘×¥/×˜×§×¡×˜ ×•×©××™×¨×” ××•×˜×•××˜×™×ª (localStorage).2. ×¡×¨×™×§×ª ×‘×¨×§×•×“ ×‘×××¦×¢×•×ª ×¦×™×œ×•× ×ª××•× ×” (Image Scan) ×›×“×™ ×œ×¢×§×•×£ ×—×¡×™××•×ª ××¦×œ××”.3. ×ª×‘× ×™×ª ××“×‘×§×” ××œ××” ×¢× ×¤×¨×˜×™ ×”×™×‘×•××Ÿ (×¡××‘×§×•).×©×™× ×œ×‘: ×§×•×“ ×–×” ×—×™×™×‘ ×œ×¨×•×¥ ××©×¨×ª HTTPS (×›××• GitHub Pages) ×›×“×™ ×©×¤×™×¦&#39;×¨ ×”×¡×¨×™×§×” ×™×¢×‘×•×“.
--><html lang="he" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>××“×¤×¡×ª ××“×‘×§×•×ª ×©×˜×— (×¡××‘×§×•)</title><!-- ×˜×¢×™× ×ª Tailwind CSS --><script src="https://www.google.com/search?q=https://cdn.tailwindcss.com"></script><!-- ×˜×¢×™× ×ª ×¡×¤×¨×™×™×ª ×¡×¨×™×§×ª ×‘×¨×§×•×“ ×§×œ×” (jsQR) - ×¢×‘×•×¨ ×§×•×“×™ QR ×‘×¢×™×§×¨ --><script src="https://www.google.com/search?q=https://cdn.jsdelivr.net/npm/jsqr%401.0.0/dist/jsQR.js"></script><style>/* ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª */body {font-family: 'Inter', sans-serif;background-color: #f0f4f8;direction: rtl;padding: 10px;}    /* ×¢×™×¦×•×‘ ×”××“×‘×§×” ×œ×ª×¦×•×’×” ×•×œ×”×“×¤×¡×” */
    .label-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .label {
        /* 30mm x 30mm ×‘×ª×•×¡×¤×ª padding ×§×˜×Ÿ */
        width: 30mm;
        height: 30mm;
        padding: 2mm;
        border: 1px solid #000;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background-color: white;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    /* ×”×’×“×¨×•×ª ×”×“×¤×¡×” ××™×•×—×“×•×ª */
    @media print {
        /* ×”×¡×ª×¨×ª ×›×œ ×”××œ×× ×˜×™× ×©××™× × ××“×‘×§×” */
        body > *:not(.print-area) { display: none !important; }
        .print-area {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            margin: 0;
        }
        .label {
            /* ×”×’×“×¨×ª ×’×•×“×œ ×”××“×‘×§×” ×”××“×•×™×§ ×œ×“×£ ×”×“×¤×¡×” */
            width: 30mm !important;
            height: 30mm !important;
            border: none;
            box-shadow: none;
            /* ×—×™×ª×•×š ××•×˜×•××˜×™ ×‘××“×¤×¡×•×ª ×’×œ×™×œ */
            page-break-after: always;
            margin: 0;
            padding: 2mm;
        }
        .label:last-child {
            page-break-after: avoid;
        }
    }

    /* ×¢×™×¦×•×‘ ×¡×¤×¦×™×¤×™ ×œ×˜×§×¡×˜ ×‘×ª×•×š ×”××“×‘×§×” */
    .sku-text { font-size: 8pt; font-weight: 600; }
    .description-text { font-size: 7.5pt; font-weight: 500; line-height: 1.1; overflow: hidden; max-height: 2.2em; }
    .price-box { font-size: 14pt; font-weight: 900; color: #000; line-height: 1; }
    .importer-text { font-size: 5pt; line-height: 1.1; overflow: hidden; max-height: 3.3em; margin-top: 1px; }

</style>
</head><body><div id="app" class="max-w-md mx-auto p-4 bg-white rounded-xl shadow-2xl">
    <h1 class="text-2xl font-bold text-center mb-6 text-indigo-700">××“×¤×¡×ª ××“×‘×§×•×ª ×©×˜×— (×¡××‘×§×•)</h1>

    <!-- ×”×•×“×¢×•×ª ×¡×˜×˜×•×¡ -->
    <div id="statusMessage" class="mb-4 text-center p-3 rounded-lg border">
        ×× × ×˜×¢×Ÿ ××ª ×”××—×™×¨×•×Ÿ ×©×œ×š ×›×“×™ ×œ×”×ª×—×™×œ.
    </div>

    <!-- 1. ×˜×¢×™× ×ª ××—×™×¨×•×Ÿ -->
    <div class="bg-gray-50 p-4 rounded-xl mb-6 border border-gray-200">
        <h2 class="text-lg font-semibold mb-3 text-gray-800">1. ×˜×¢×™× ×ª ××—×™×¨×•×Ÿ (JSON)</h2>
        <p class="text-xs text-gray-500 mb-2">
            ×”×§×¤×“ ×œ×”×©×ª××© ×‘×›×•×ª×¨×•×ª: <span class="font-mono bg-gray-200 p-1 rounded">sku, description, price, barcode</span>. ×”× ×ª×•× ×™× × ×©××¨×™× ××•×˜×•××˜×™×ª ×‘××›×©×™×¨.
        </p>
        
        <!-- ×˜×¢×™× ×ª ×§×•×‘×¥ JSON -->
        <div class="flex items-center space-x-2 mb-3">
            <input type="file" id="jsonFile" accept=".json" class="hidden" onchange="handleFileLoad(event)">
            <button onclick="document.getElementById('jsonFile').click()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                ×‘×—×¨ ×§×•×‘×¥ ××—×™×¨×•×Ÿ JSON ××”××›×©×™×¨
            </button>
            <button onclick="loadData(document.getElementById('jsonInput').value)" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                ×˜×¢×Ÿ ×˜×§×¡×˜ ×™×“× ×™ ×•×©××•×¨
            </button>
        </div>
        
        <textarea id="jsonInput" rows="5" placeholder="×”×“×‘×§ ×›××Ÿ ××ª ×˜×§×¡×˜ ×”-JSON ×”××œ× ×©×”×•××¨ ××”××§×¡×œ..." class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>

        <button onclick="loadSampleData()" class="mt-2 text-sm text-indigo-500 hover:text-indigo-700 font-semibold transition duration-300">×˜×¢×Ÿ ×“×•×’××ª ××—×™×¨×•×Ÿ ××”×™×¨×”</button>
    </div>

    <!-- 2. ×”×–×× ×” ×•×”×“×¤×¡×” -->
    <div class="bg-white p-4 rounded-xl shadow-md border border-indigo-200">
        <h2 class="text-lg font-semibold mb-3 text-gray-800">2. ×”×–× ×” ×•×‘×™×¦×•×¢</h2>
        <div class="grid grid-cols-1 gap-4">
            
            <input type="text" id="inputSku" oninput="updatePreview()" placeholder="××§''×˜ / ×‘×¨×§×•×“" class="p-3 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-lg">

            <input type="number" id="inputQuantity" oninput="updatePreview()" value="1" min="1" placeholder="×›××•×ª ××“×‘×§×•×ª" class="p-3 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-lg">

            <!-- ×§×œ×˜ × ×¡×ª×¨ ×œ×˜×¢×™× ×ª ×ª××•× ×” ××”××¦×œ××”/×’×œ×¨×™×” -->
            <input type="file" id="barcodeImageInput" accept="image/*" class="hidden" onchange="handleImageScan(event)">

            <button onclick="document.getElementById('barcodeImageInput').click()" id="scanButton" disabled class="bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:bg-indigo-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 inline-block mr-2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.125 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.125 9.375v-4.5ZM13.125 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5Z" />
                </svg>
                ×¡×¨×•×§ ×‘×¨×§×•×“ (×¦×™×œ×•× ×ª××•× ×”)
            </button>
        </div>
        
        <button onclick="printLabels()" id="printButton" disabled class="w-full bg-red-600 text-white font-black text-xl py-3 px-4 rounded-lg shadow-xl hover:bg-red-700 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed mt-4">
            ×”×“×¤×¡ ××“×‘×§×•×ª (×¢×‘×•×¨ ××“×¤×¡×•×ª ×ª×¢×©×™×™×ª×™×•×ª)
        </button>
        <p class="text-xs text-center text-gray-500 mt-2">
            ×œ×ª×©×•××ª ×œ×‘×š: ×× ××ª×” ××©×ª××© ×‘××“×¤×¡×ª Niimbot B21, ×›×¤×ª×•×¨ ×–×” ×œ× ×™×¢×‘×•×“ ×™×©×™×¨×•×ª.
        </p>
    </div>

    <!-- 3. ×ª×¦×•×’×” ××§×“×™××” -->
    <div class="mt-8">
        <h2 class="text-lg font-semibold mb-3 text-gray-800 text-center">3. ×ª×¦×•×’×” ××§×“×™××”</h2>
        <div id="previewArea" class="label-container justify-center items-center">
            <div class="text-center text-gray-400 p-4 border border-dashed rounded-lg">
                ×”××“×‘×§×” ×ª×•×¦×’ ×›××Ÿ ×œ××—×¨ ×”×–× ×ª ××§"×˜ ×•×›××•×ª.
            </div>
        </div>
    </div>
</div>

<!-- ××–×•×¨ ×”×“×¤×¡×” ×‘×¤×•×¢×œ (××•×¡×ª×¨) -->
<div id="printArea" class="print-area absolute top-0 left-0 hidden"></div>

<script>
    // ××¤×” ×œ×©××™×¨×ª × ×ª×•× ×™ ×”××—×™×¨×•×Ÿ (×’×™×©×” ××”×™×¨×” ×œ×¤×™ SKU/×‘×¨×§×•×“)
    let priceMap = new Map();
    
    // ×¤×¨×˜×™ ×”×™×‘×•××Ÿ ×”×§×‘×•×¢×™× (××¢×•×“×›×Ÿ ×œ×¤×™ ×‘×§×©×ª×š)
    const IMPORTER_INFO = {
        importer: "×™×‘×•××Ÿ: ×¡××‘×§×• ××¡×¤×§×” ×˜×›× ×™×ª ×‘×¢\"×",
        address: "×›×ª×•×‘×ª: ×—×•×¦×•×ª ×”×™×•×¦×¨ 13 ××©×§×œ×•×Ÿ",
        manufacturer: "×™×¦×¨×Ÿ: ×˜×¨×•×¤×¨",
        country: "××¨×¥ ×™×™×¦×•×¨: ×¡×™×Ÿ"
    };
    
    // --- ×¤×•× ×§×¦×™×•×ª ×˜×¢×™× ×ª × ×ª×•× ×™× ---

    /**
     * ××˜×¢×™×Ÿ ××ª × ×ª×•× ×™ ×”××—×™×¨×•×Ÿ ××©×“×” ×˜×§×¡×˜ ××• ×§×•×‘×¥, ×©×•××¨ ×‘-localStorage ×•××¢×“×›×Ÿ ××ª ×”××¤×”.
     * @param {string} jsonString - ×”××—×¨×•×–×ª JSON ×œ×˜×¢×™× ×”.
     */
    function loadData(jsonString) {
        const statusMessage = document.getElementById('statusMessage');
        const jsonInput = document.getElementById('jsonInput');
        
        if (!jsonString || jsonString.trim() === '') {
            statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-yellow-500 bg-yellow-100 text-yellow-800';
            statusMessage.textContent = 'âš ï¸ ×©×“×” ×”×˜×§×¡×˜ ×¨×™×§. ×œ× ×‘×•×¦×¢×” ×˜×¢×™× ×”.';
            return;
        }

        try {
            const data = JSON.parse(jsonString);
            if (!Array.isArray(data)) {
                 throw new Error("JSON ××™× ×• ××¢×¨×š.");
            }

            priceMap.clear();
            data.forEach(item => {
                // ×•×“× ×©×œ×¤×—×•×ª SKU ×•×ª×™××•×¨ ×§×™×™××™×
                if (item.sku && item.description) {
                    // ×”×•×¤×š ××ª ×”××—×™×¨ ×œ××¡×¤×¨
                    item.price = parseFloat(item.price);

                    // 1. ×”×•×¡×¤×” ×œ××™× ×“×§×¡ ×œ×¤×™ SKU
                    priceMap.set(String(item.sku).trim(), item);
                    
                    // 2. ×”×•×¡×¤×” ×œ××™× ×“×§×¡ ×œ×¤×™ ×‘×¨×§×•×“ (×× ×§×™×™×)
                    if (item.barcode) {
                        priceMap.set(String(item.barcode).trim(), item);
                    }
                }
            });

            // ×©××™×¨×” ×‘-localStorage ×¨×§ ×× × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”
            localStorage.setItem('priceMapJSON', jsonString);
            
            // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡
            statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-green-500 bg-green-100 text-green-800';
            statusMessage.textContent = `âœ… ×”××—×™×¨×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! ${priceMap.size} ×¤×¨×™×˜×™× ×‘××¢×¨×›×ª.`;
            
            // ×”×¤×¢×œ×ª ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×”
            document.getElementById('scanButton').disabled = false;
            document.getElementById('printButton').disabled = false;
            jsonInput.value = ''; // × ×™×§×•×™ ×©×“×” ×”×§×œ×˜ ×œ××—×¨ ×˜×¢×™× ×” ××•×¦×œ×—×ª
            
        } catch (error) {
            statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-red-500 bg-red-100 text-red-800';
            statusMessage.textContent = `âŒ ×©×’×™××ª ×˜×¢×™× ×ª JSON: ×× × ×•×“× ×©×”×§×•×‘×¥ ×ª×§×™×Ÿ. ×¤×¨×˜×™ ×”×©×’×™××”: ${error.message}`;
        }
    }

    /**
     * ×˜×•×¢×Ÿ × ×ª×•× ×™× ×œ×“×•×’××” ×•××¢×“×›×Ÿ ××ª ×”××¢×¨×›×ª.
     */
    function loadSampleData() {
        const sampleJson = `[
            {"sku": "10235", "description": "××¨×¡×¡ ×¤×¨×—×™× ××©××‘×” 2 ×œ×™×˜×¨", "price": "61.00", "barcode": "7290000102358"},
            {"sku": "1567", "description": "××‘×¨×’×” × ×˜×¢× ×ª 18V ×¢× ×–×•×’ ×¡×•×œ×œ×•×ª", "price": "499.00", "barcode": "7290000156701"},
            {"sku": "8020", "description": "××¤×ª×— ×©×•×•×“×™ ××ª×›×•×•× ×Ÿ 10 ××™× ×¥' ××¤×œ×“×”", "price": "75.00", "barcode": "7290000802011"}
        ]`;
        document.getElementById('jsonInput').value = sampleJson;
        loadData(sampleJson);
    }

    /**
     * ×§×•×¨× ×§×•×‘×¥ JSON ×©× ×‘×—×¨ ×¢×œ ×™×“×™ ×”××©×ª××©.
     * @param {Event} event - ××™×¨×•×¢ ×‘×—×™×¨×ª ×”×§×•×‘×¥.
     */
    function handleFileLoad(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            loadData(e.target.result); // ×§×•×¨× ××ª ×”×ª×•×›×Ÿ ×”×˜×§×¡×˜×•××œ×™ ×•×©×•×œ×— ×œ-loadData
        };
        reader.onerror = () => {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-red-500 bg-red-100 text-red-800';
            statusMessage.textContent = 'âŒ ×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥.';
        };
        reader.readAsText(file);
    }


    // --- ×¤×•× ×§×¦×™×•×ª ×ª×¦×•×’×” ×•×”×“×¤×¡×” ---

    /**
     * ××—×•×œ×œ ××ª HTML ×©×œ ××“×‘×§×” ×‘×•×“×“×ª.
     * @param {Object} item - ××•×‘×™×™×§×˜ ×”×¤×¨×™×˜ (sku, description, price).
     * @returns {string} - ××—×¨×•×–×ª HTML ×©×œ ×”××“×‘×§×”.
     */
    function createLabelHTML(item) {
        // ×”×•×¡×¤×ª toFixed(2) ×›×“×™ ×œ×•×•×“× ×©××•×¦×’×•×ª ×©×ª×™ ×¡×¤×¨×•×ª ××—×¨×™ ×”× ×§×•×“×” ×’× ×œ××—×™×¨ ×¢×’×•×œ
        const price = item.price.toFixed(2); 

        // ×¤×¨×˜×™ ×™×‘×•××Ÿ ××œ××™×, ×›×•×œ×œ ×©×‘×™×¨×•×ª ×©×•×¨×”
        const importerDetails = `
            ${IMPORTER_INFO.importer}<br>
            ${IMPORTER_INFO.address}<br>
            ${IMPORTER_INFO.manufacturer} / ${IMPORTER_INFO.country}
        `;

        return `
            <div class="label" style="text-align: right;">
                <!-- ×—×œ×§ ×¢×œ×™×•×Ÿ: ××§"×˜ ×•×ª×™××•×¨ -->
                <div class="flex flex-col flex-grow">
                    <div class="sku-text">××§"×˜: ${item.sku}</div>
                    <div class="description-text mt-1 text-black">${item.description}</div>
                    <!-- ××–×•×¨ ×¨×™×§ ×§×˜×Ÿ -->
                    <div class="flex-grow"></div> 
                </div>

                <!-- ×—×œ×§ ×ª×—×ª×•×Ÿ: ××—×™×¨ ×•×¤×¨×˜×™ ×™×‘×•××Ÿ -->
                <div class="flex flex-col items-end">
                    <div class="price-box leading-none">
                        <span style="font-size: 10pt; font-weight: 500;">××—×™×¨:</span> â‚ª${price}
                    </div>
                    <div class="importer-text text-gray-700 text-right mt-1" style="line-height: 1.1;">
                        ${importerDetails}
                    </div>
                </div>
            </div>
        `;
    }

    /**
     * ××¢×“×›×Ÿ ××ª ×”×ª×¦×•×’×” ×”××§×“×™××” ×¢×œ ×‘×¡×™×¡ ×”×§×œ×˜ ×”× ×•×›×—×™.
     */
    function updatePreview() {
        const inputSkuValue = String(document.getElementById('inputSku').value).trim();
        const previewArea = document.getElementById('previewArea');
        previewArea.innerHTML = '';
        
        if (priceMap.size === 0) return;

        // ××¦×™××ª ×”×¤×¨×™×˜ ×œ×¤×™ SKU ××• ×‘×¨×§×•×“
        const item = priceMap.get(inputSkuValue);

        if (item && inputSkuValue) {
            // ×”×¦×’×ª ××“×‘×§×” ×‘×•×“×“×ª ×œ×ª×¦×•×’×” ××§×“×™××”
            previewArea.innerHTML = createLabelHTML(item);
        } else if (inputSkuValue) {
            // ×¤×¨×™×˜ ×œ× × ××¦×
            previewArea.innerHTML = `<div class="text-center text-red-500 p-4 border border-red-300 rounded-lg">×¤×¨×™×˜ (××§"×˜ / ×‘×¨×§×•×“) "${inputSkuValue}" ×œ× × ××¦× ×‘××—×™×¨×•×Ÿ.</div>`;
        } else {
             // ×§×œ×˜ ×¨×™×§
             previewArea.innerHTML = `<div class="text-center text-gray-400 p-4 border border-dashed rounded-lg">×”××“×‘×§×” ×ª×•×¦×’ ×›××Ÿ ×œ××—×¨ ×”×–× ×ª ××§"×˜ ×•×›××•×ª.</div>`;
        }
    }

    /**
     * ××›×™×Ÿ ×•××¤×¢×™×œ ××ª ×”×“×¤×¡×ª ×”×“×¤×“×¤×Ÿ.
     */
    function printLabels() {
        const inputSkuValue = String(document.getElementById('inputSku').value).trim();
        const inputQuantityValue = parseInt(document.getElementById('inputQuantity').value);
        const printArea = document.getElementById('printArea');
        const item = priceMap.get(inputSkuValue);

        if (!item || inputQuantityValue <= 0 || priceMap.size === 0) {
            // ×©×™××•×© ×‘×”×•×“×¢×ª ××¢×¨×›×ª ×‘××§×•× alert
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-red-500 bg-red-100 text-red-800';
            statusMessage.textContent = 'âŒ ×× × ×”×–×Ÿ ××§"×˜/×‘×¨×§×•×“ ×ª×§×™×Ÿ ×•×›××•×ª ×’×“×•×œ×” ×-0.';
            return;
        }

        // ×™×¦×™×¨×ª ×›×œ ×”××“×‘×§×•×ª ×”× ×“×¨×©×•×ª
        let labelsHTML = '';
        for (let i = 0; i < inputQuantityValue; i++) {
            labelsHTML += createLabelHTML(item);
        }

        // ×”×›× ×¡×ª ×”-HTML ×œ××–×•×¨ ×”××•×¡×ª×¨ ×•×”×“×¤×¡×”
        printArea.innerHTML = labelsHTML;
        printArea.classList.remove('hidden');

        window.print();
        
        // × ×™×§×•×™ ××–×•×¨ ×”×”×“×¤×¡×” ×•×”×¦×’×” ××—×“×© ×œ××—×¨ ×”×”×“×¤×¡×”
        setTimeout(() => {
            printArea.classList.add('hidden');
            printArea.innerHTML = '';
        }, 500); // × ×•×ª×Ÿ ×–××Ÿ ×§×¦×¨ ×œ×”×“×¤×¡×” ×œ×§×¨×•×ª
    }


    // --- ×¤×•× ×§×¦×™×•×ª ×¡×¨×™×§×ª ×‘×¨×§×•×“ ×‘×××¦×¢×•×ª ×ª××•× ×” (×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×§×‘×¦×™× ××§×•××™×™×) ---

    /**
     * ××˜×¤×œ ×‘×§×•×‘×¥ ×”×ª××•× ×” ×©×¦×•×œ× ××”××¦×œ××” ××• × ×‘×—×¨ ××”×’×œ×¨×™×”.
     */
    function handleImageScan(event) {
        const file = event.target.files[0];
        const statusMessage = document.getElementById('statusMessage');
        
        if (!file) return;

        // ×¢×“×›×•×Ÿ ×”×•×“×¢×ª ×¡×˜×˜×•×¡
        statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-blue-500 bg-blue-100 text-blue-800';
        statusMessage.textContent = 'ğŸ”„ ××¤×¢× ×— ×ª××•× ×”, ×× × ×”××ª×Ÿ...';

        const reader = new FileReader();
        reader.onload = (e) => {
            decodeBarcodeFromImage(e.target.result)
                .then(decodedText => {
                    document.getElementById('inputSku').value = decodedText.trim();
                    updatePreview();
                    statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-green-500 bg-green-100 text-green-800';
                    statusMessage.textContent = `âœ… ×‘×¨×§×•×“ × ××¦×: ${decodedText}. ×”×¤×¨×™×˜ × ×˜×¢×Ÿ.`;
                })
                .catch(error => {
                    statusMessage.className = 'mb-4 text-center p-3 rounded-lg border border-red-500 bg-red-100 text-red-800';
                    statusMessage.textContent = `âŒ ×©×’×™××ª ×¡×¨×™×§×”: ${error.message}`;
                })
                .finally(() => {
                    // ××™×¤×•×¡ ×©×“×” ×”×§×•×‘×¥ ×›×“×™ ×œ××¤×©×¨ ×¦×™×œ×•× × ×•×¡×£
                    event.target.value = null;
                });
        };
        reader.readAsDataURL(file);
    }

    /**
     * ×¤×•× ×§×¦×™×” ×—×™×¦×•× ×™×ª ×œ×˜×¢×™× ×ª ×ª××•× ×” ×•×¤×¢× ×•×— ×‘×¨×§×•×“.
     * ××›×™×•×•×Ÿ ×©××™ ××¤×©×¨ ×œ×”×©×ª××© ×‘×¡×¤×¨×™×™×” ×—×–×§×” ×œ×¤×¢× ×•×— ×‘×¨×§×•×“×™× ×œ×™× ××¨×™×™× ××§×•×‘×¥ ××§×•××™,
     * ×”×¤×•× ×§×¦×™×” ×”×–×• ×× ×¡×” ×œ×–×”×•×ª ×§×•×“×™ QR (×‘×××¦×¢×•×ª jsQR) ×‘×œ×‘×“.
     * ×œ×¤×¢× ×•×— ×‘×¨×§×•×“×™× ×œ×™× ××¨×™×™× ×¡×˜× ×“×¨×˜×™×™×, × ×“×¨×© ×©×¨×ª.
     */
    function decodeBarcodeFromImage(imageDataURL) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0, img.width, img.height);
                
                const imageData = ctx.getImageData(0, 0, img.width, img.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                
                if (code && code.data) {
                    // ×§×•×“ QR × ××¦×
                    resolve(code.data);
                } else {
                    // ×§×•×“ QR ×œ× × ××¦×. ×–×” ×œ× ××•××¨ ×©××™×Ÿ ×‘×¨×§×•×“ ×œ×™× ××¨×™,
                    // ××‘×œ ×œ× × ×™×ª×Ÿ ×œ×¤×¢× ×— ××•×ª×• ×œ×œ× ×©×™×¨×•×ª ×¦×“ ×©×¨×ª.
                    reject(new Error("×œ× × ××¦× ×§×•×“ (QR) ×§×¨×™×. ×œ×¤×¢× ×•×— ×‘×¨×§×•×“×™× ×œ×™× ××¨×™×™× × ×“×¨×©×ª ×”×¢×œ××” ×œ×©×¨×ª."));
                }
            };
            img.onerror = () => reject(new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª××•× ×” ××”××¦×œ××”/×’×œ×¨×™×”."));
            img.src = imageDataURL;
        });
    }


    // --- ××ª×—×•×œ ×”××¢×¨×›×ª ---

    /**
     * ×¤×•× ×§×¦×™×™×ª ××ª×—×•×œ ×”××•×¤×¢×œ×ª ×‘×˜×¢×™× ×ª ×”×“×£.
     */
    window.onload = function() {
        // × ×¡×” ×œ×˜×¢×•×Ÿ × ×ª×•× ×™× ××”×–×™×›×¨×•×Ÿ ×”××§×•××™
        const storedData = localStorage.getItem('priceMapJSON');
        if (storedData) {
            loadData(storedData);
        }

        // ××•×•×“××™× ×©××¦×‘ ×”×›×¤×ª×•×¨×™× ××©×§×£ ××ª ×”××¦×‘ ×”× ×•×›×—×™ ×©×œ priceMap
        if (priceMap.size > 0) {
            document.getElementById('scanButton').disabled = false;
            document.getElementById('printButton').disabled = false;
        }
        
        // ××¤×¢×™×œ ××ª ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×”××§×“×™××” ×¢×œ ×× ×ª ×œ×”×¦×™×’ ××¦×‘ ×”×ª×—×œ×”
        updatePreview();
    };

</script>
</body></html>